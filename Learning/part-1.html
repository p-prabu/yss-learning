<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЗро░ро╛роЬ ропрпЛроХроорпН рооро▒рпНро▒рпБроорпН роЖройрпНрооро╛ро╡ро┐ройрпН рокропрогроорпН</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Tamil', sans-serif;
            background-color: #fdfbf7;
        }
        .gradient-text {
            background: linear-gradient(to right, #d97706, #b45309);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Breathing Timer Styles */
        .clock-face {
            background: conic-gradient(
                #60a5fa 0deg 110.76deg,    /* Blue - Inhale */
                #facc15 110.76deg 221.52deg, /* Yellow - Hold */
                #4ade80 221.52deg 332.28deg, /* Green - Exhale */
                #a855f7 332.28deg 360deg   /* Purple - Break */
            );
        }
        .hand {
            transform-origin: bottom center;
            transition: transform 0.1s linear;
            box-shadow: 0 0 10px 2px rgba(0, 0, 0, 0.25);
        }
        .hand::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-bottom: 10px solid #dc2626; /* red tip */
            filter: drop-shadow(0 0 4px rgba(220, 38, 38, 0.35));
        }
        .tick-ring {
            background: repeating-conic-gradient(
                #e5e7eb 0deg 1deg,
                transparent 1deg 5.538deg
            );
            opacity: 0.55;
        }
        .breath-face {
            width: clamp(11rem, 32vw, 17rem);
            height: clamp(11rem, 32vw, 17rem);
        }
        .breath-core {
            width: 70%;
            height: 70%;
        }
        #breath-timer-display {
            font-size: clamp(1.5rem, 4vw, 2rem);
        }
        #breath-phase-label {
            font-size: clamp(0.6rem, 2vw, 0.7rem);
        }
        .wake-active {
            background-color: #dcfce7 !important;
            color: #166534 !important;
            box-shadow: 0 0 0 2px #bbf7d0 inset !important;
        }
        .second-indicator {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 1.5px;
            height: 46%;
            background: linear-gradient(to top, rgba(37,99,235,0.05), rgba(37,99,235,0.85));
            transform-origin: bottom center;
            border-radius: 9999px;
            box-shadow: 0 0 4px rgba(37,99,235,0.45);
            pointer-events: none;
        }
        .second-indicator::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 8px solid rgba(37,99,235,0.95);
            filter: drop-shadow(0 0 3px rgba(37,99,235,0.35));
        }
        #breath-timer-card {
            background: radial-gradient(circle at 30% 30%, #f9fafb 0%, #eef2ff 55%, #e5e7eb 100%);
            border-color: #e5e7eb;
        }
        /* Night theme for breathing timer */
        .breath-night {
            background: radial-gradient(circle at 30% 30%, #0f172a 0%, #111827 55%, #0b1220 100%) !important;
            border-color: #1f2937 !important;
        }
        .breath-night .breath-core {
            background: #0b1220 !important;
            color: #e5e7eb !important;
        }
        .breath-night #breath-timer-display,
        .breath-night #breath-phase-label {
            color: #e5e7eb !important;
        }
        .breath-night .tick-ring {
            background: repeating-conic-gradient(
                #1f2937 0deg 1deg,
                transparent 1deg 5.538deg
            );
            opacity: 0.65;
        }
        .breath-night .second-indicator {
            background: linear-gradient(to top, rgba(239,68,68,0.08), rgba(239,68,68,0.9));
            box-shadow: 0 0 6px rgba(239,68,68,0.45);
        }
        .breath-night .second-indicator::after {
            border-bottom-color: rgba(239,68,68,0.95);
            filter: drop-shadow(0 0 4px rgba(239,68,68,0.4));
        }
        /* Meditation card styling */
        #med-card {
            background: radial-gradient(circle at 25% 20%, #e0f2fe 0%, #bfdbfe 45%, #fef3c7 90%);
            border-color: #dbeafe;
            color: #0f172a;
        }
        #med-phase-display { color: #1f2937; }
        #med-timer-display { color: #0f172a; }
        #med-progress { background-color: #3b82f6; }
        #med-card .bg-indigo-800 { background-color: #dbeafe; }
        #med-wave { display: none; }
        .med-night {
            background: radial-gradient(circle at 25% 25%, #0b1220 0%, #0f172a 55%, #0b1220 100%);
            border-color: #1f2937;
            color: #e5e7eb;
        }
        .med-night #med-phase-display { color: #e5e7eb; }
        .med-night #med-timer-display { color: #f8fafc; }
        .med-night #med-progress { background-color: #818cf8; }
        .med-night .bg-indigo-800 { background-color: #0f172a; }
        /* Meditation phase backgrounds */
        #med-card.med-warm { background: radial-gradient(circle at 20% 15%, #fef9c3 0%, #fde68a 45%, #fef3c7 90%); color: #1f2937; }
        #med-card.med-active { background: radial-gradient(circle at 25% 20%, #e0f2fe 0%, #bfdbfe 45%, #dbeafe 90%); color: #0f172a; }
        #med-card.med-silence { background: radial-gradient(circle at 20% 20%, #d1fae5 0%, #a7f3d0 50%, #d1fae5 95%); color: #064e3b; }
        /* Light flame meditation */
        .flame-wrap { position: relative; width: 240px; margin: 0 auto; }
        .flame-photo {
            width: 100%;
            border-radius: 18px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.35);
            background: radial-gradient(circle at 50% 20%, rgba(255,182,97,0.35), rgba(0,0,0,0.8));
        }
        .flame-layout {}
        .flame-select {
            width: 200px;
            border-radius: 12px;
            padding: 10px 14px;
            border: 1px solid rgba(251, 146, 60, 0.35);
            background: rgba(255, 255, 255, 0.9);
            color: #7c2d12;
            font-weight: 700;
            letter-spacing: 0.4px;
            box-shadow: 0 12px 24px rgba(251, 146, 60, 0.15);
        }
        .flame-progress {
            height: 12px;
            background: rgba(249, 115, 22, 0.15);
            border-radius: 999px;
            overflow: hidden;
        }
        .flame-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #fed7aa, #fb923c);
            transition: width 0.3s ease;
        }
        /* Fullscreen flame view */
        .flame-only { background: #000 !important; border-color: #111 !important; }
        .flame-only .flame-layout {
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
        }
        .flame-only .flame-select-row { display: none !important; }
        .flame-only .flame-controls { display: none !important; }
        .flame-only .flame-timer-box {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            max-width: 320px;
            width: 100%;
        }
        .flame-only .flame-timer-box .flame-progress { opacity: 0.7; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Hero Section -->
    <header class="bg-orange-50 py-12 px-4 border-b-4 border-orange-200">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-orange-800 mb-4">роЗро░ро╛роЬ ропрпЛроХроорпН & роЖройрпНроо роЮро╛ройроорпН</h1>
            <p class="text-xl md:text-2xl text-orange-700 italic font-serif leading-relaxed">
                "роЗро▒рпИро╡ройродрпБ роЪро░рпНро╡ро╡ро┐ропро╛рокроХроорпЗ роироородрпБ роЪро░рпНро╡ро╡ро┐ропро╛рокроХроорпБроорпН..."
            </p>
            <div class="mt-6 w-24 h-1 bg-orange-400 mx-auto rounded"></div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-8 space-y-12">

        <!-- Introduction Section -->
        <section class="bg-white rounded-2xl shadow-lg p-8 border-l-8 border-orange-400">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                роЖройрпНрооро╛ро╡ро┐ройрпН роЗрогрпИрокрпНрокрпБ
            </h2>
            <p class="text-lg leading-relaxed text-gray-700">
                роЪро┐ро▒роирпНрод роЗроирпНродро┐роп роЖройрпНроорпАроХ роЖроЪро╛ройрпНроХро│рпН родрпЖропрпНро╡рпАроХрокрпН рокрпЗро░ро┐ро░рпБрокрпНрокрпБроЯройрпН роЙрогро░рпНро╡рпБрокрпВро░рпНро╡рооро╛рой родрпКроЯро░рпНрокрпИ роПро▒рпНрокроЯрпБродрпНродрпБро╡родро▒рпНроХро╛роХ 
                <span class="font-semibold text-orange-700">роЗро░ро╛роЬ ропрпЛроХроорпН</span> роОройрпБроорпН ро╡ро┤ро┐роорпБро▒рпИропрпИ роХрогрпНроЯро▒ро┐роирпНродройро░рпН. 
                роЗродрпБ родройро┐рооройро┐род роЖройрпНроо-роЕро▓рпИропрпИ рокро░роорпНрокрпКро░рпБро│рпН роОройрпБроорпН роХроЯро▓рпБроЯройрпН роорпАрогрпНроЯрпБроорпН роЗрогрпИроХрпНроХрпБроорпН ро╡ро┐роЮрпНроЮро╛ройрооро╛роХрпБроорпН.
            </p>
            <div class="mt-6 bg-orange-50 p-6 rounded-lg border border-orange-100">
                <p class="text-xl font-serif text-center text-orange-900">
                    "роЙроЯро▓рпИ ро╡ро░рпБродрпНродро┐родрпН родро╡роорпН роЪрпЖропрпНрокро╡ро░рпНроХро│рпИ ро╡ро┐роЯ ропрпЛроХро┐ роЪро┐ро▒роирпНродро╡ройрпН...<br>
                    роОройро╡рпЗ, роУ роЕро░рпНроЬрпБройро╛, роирпА ропрпЛроХро┐ роЖроХрпБроХ!"
                </p>
                <p class="text-right text-sm font-bold text-orange-600 mt-2">- рокроХро╡родрпН роХрпАродрпИ (рокроХро╡ро╛ройрпН роХро┐ро░рпБро╖рпНрогройрпН)</p>
            </div>
        </section>

        <!-- Thoughts to Live By -->
        <section class="bg-amber-50 rounded-2xl shadow-lg p-8 border border-amber-200">
            <h2 class="text-2xl font-bold text-amber-900 mb-6 flex items-center">
                ЁЯМЯ ро╡ро╛ро┤ ро╡ро┤ро┐роХро╛роЯрпНроЯрпБроорпН роЪро┐роирпНродройрпИроХро│рпН
            </h2>
            <div class="relative">
                <span class="absolute top-0 left-0 text-6xl text-amber-200 -z-10">тЭЭ</span>
                <p class="text-lg text-gray-800 italic leading-relaxed pl-8 mb-4">
                    "роиро╛роорпН роЗро▒рпИро╡ройро┐роЯрооро┐ро░рпБроирпНродрпБ роХрпАро┤ро┐ро▒роЩрпНроХро┐ ро╡роирпНродро┐ро░рпБроХрпНроХро┐ро▒рпЛроорпН, роорпЗро▓рпБроорпН роиро╛роорпН роЕро╡ройро┐роЯроорпЗ родро┐ро░рпБроорпНрок роорпЗро▓рпЗро▒ро┐роЪрпН роЪрпЖро▓рпНро▓ ро╡рпЗрогрпНроЯрпБроорпН. роиро╛роорпН роироородрпБ родрпЖропрпНро╡родрпН родроирпНродрпИропро┐роЯрооро┐ро░рпБроирпНродрпБ рокро┐ро░ро┐роирпНродро┐ро░рпБрокрпНрокродро╛роХродрпН родрпЛройрпНро▒рпБроХро┐ро▒родрпБ, роорпЗро▓рпБроорпН роиро╛роорпН роЕро╡ро░рпБроЯройрпН роЙрогро░рпНро╡рпБрокрпВро░рпНро╡рооро╛роХ роорпАрогрпНроЯрпБроорпН роРроХрпНроХро┐ропрооро╛роХ ро╡рпЗрогрпНроЯрпБроорпН. ропрпЛроХроорпН роироороХрпНроХрпБ, роОрокрпНрокроЯро┐ рокро┐ро░ро┐ро╡рпЖройрпБроорпН рооро╛ропрпИропро┐ро▓ро┐ро░рпБроирпНродрпБ роорпЗро▓рпЖро┤рпБроирпНродрпБ роЗро▒рпИро╡ройрпБроЯройро╛рой роироородрпБ роРроХрпНроХро┐ропродрпНродрпИ роЙрогро░рпНроирпНродро▒ро┐ро╡родрпБ роОройрпНро▒рпБ рокрпЛродро┐роХрпНроХро┐ро▒родрпБ."
                </p>
                <p class="text-right font-bold text-amber-800 mt-4">- рокро░рооро╣роорпНро╕ ропрпЛроХро╛ройроирпНродро░рпН</p>
            </div>
        </section>

        <!-- Spiritual Eye Section -->
        <section class="bg-white rounded-2xl shadow-lg p-8 border-t-4 border-purple-600">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <div class="w-full md:w-2/3">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        ЁЯСБя╕П роЖройрпНроорпАроХроХрпН роХрогрпН (The Spiritual Eye)
                    </h2>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        родро┐ропро╛ройрокрпН рокропро┐ро▒рпНроЪро┐ропро┐ройрпН родрпБро╡роХрпНроХродрпНродро┐ро▓ро┐ро░рпБроирпНродрпЗ, рокрпБро░рпБро╡роородрпНродро┐ропро┐ро▓рпН роЕроорпИроирпНродрпБро│рпНро│ роЪроХрпНродро┐ро╡ро╛ропрпНроирпНрод <span class="font-semibold text-purple-700">роХрпВроЯро╕рпНрод роЙрогро░рпНро╡рпБроиро┐ро▓рпИ роорпИропродрпНродрпИрокрпН</span> (Kutastha) рокро▒рпНро▒ро┐ роЕро▒ро┐ро╡родрпБ роЕро╡роЪро┐ропроорпН.
                    </p>
                    <ul class="list-disc list-inside space-y-3 text-gray-700 marker:text-purple-500">
                        <li><strong>роЗро░рпБрокрпНрокро┐роЯроорпН:</strong> рокрпБро░рпБро╡роородрпНродро┐ ("роТро▒рпНро▒рпИроХрпНроХрогрпН" роЕро▓рпНро▓родрпБ "ро╡ро╛ропро┐ро▓рпН").</li>
                        <li><strong>родрпКроЯро░рпНрокрпБ:</strong> роЗродрпБ роорпВро│рпИропро┐ройрпН роЕроЯро┐ропро┐ро▓рпН роЙро│рпНро│ рокрпАройро┐ропро▓рпН роЪрпБро░рокрпНрокро┐ропро┐ройрпН (Pineal Gland) рокро┐ро░родро┐рокро▓ро┐рокрпНрокрпБ <span class="text-xs text-gray-500">(роЖроЮрпНроЮро╛ роЪроХрпНроХро░роорпН)</span>.</li>
                        <li><strong>ро╡роЯро┐ро╡роорпН:</strong> ро╡рпЖро│рпНро│ро┐ропрпИрокрпН рокрпЛро▓ роТро│ро┐ро░рпБроорпН роРроорпНроорпБроХ ро╡рпЖрогрпНрогро┐ро▒ роироЯрпНроЪродрпНродро┐ро░роорпН.</li>
                    </ul>
                </div>
                <div class="w-full md:w-1/3 flex flex-col items-center justify-center">
                    <div class="relative w-56 h-56 bg-indigo-950 rounded-full flex items-center justify-center shadow-2xl border-[20px] border-yellow-400 ring-4 ring-yellow-200/50 overflow-hidden">
                        <div class="absolute inset-2 bg-blue-800 rounded-full shadow-inner ring-8 ring-blue-900/50"></div>
                        <div class="relative text-white text-8xl font-black drop-shadow-[0_0_20px_rgba(255,255,255,1)] pb-3">тШЕ</div>
                    </div>
                    <p class="mt-6 text-sm font-bold text-purple-800">роЖройрпНроорпАроХроХрпН роХрогрпНрогро┐ройрпН роХрпБро▒ро┐ропрпАроЯрпБ</p>
                </div>
            </div>
        </section>

        <!-- Daily Practice Section -->
        <section id="daily-practice" class="space-y-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-orange-900">родро┐ройроЪро░ро┐ родро┐ропро╛ройрокрпН рокропро┐ро▒рпНроЪро┐</h2>
            </div>

            <!-- 1. Sankalpam Card -->
            <div class="bg-yellow-50 rounded-xl shadow-md p-6 border-l-8 border-yellow-500 relative overflow-hidden">
                <h3 class="text-xl font-bold text-yellow-800 mb-4 flex items-center">
                    <span class="bg-yellow-200 text-yellow-800 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                    роЪроЩрпНроХро▓рпНрокроорпН (Affirmation)
                </h3>
                <p class="text-lg md:text-xl italic text-gray-800 font-serif leading-relaxed text-center px-4 md:px-12">
                    "роиро╛ройрпН роЙроЯро▓ро▓рпНро▓, роЗро░родрпНродрооро▓рпНро▓, роЪроХрпНродро┐ропро▓рпНро▓, роОрогрпНрогроЩрпНроХро│ро▓рпНро▓, рооройрооро▓рпНро▓, роЕроХроирпНродрпИропро▓рпНро▓, роЪрпВроЯрпНроЪрпБроо роЙроЯро▓рпБрооро▓рпНро▓; роЕро╡ро▒рпНро▒рпИ роТро│ро┐ропрпВроЯрпНроЯро┐, роЕро╡рпИ рооро╛ро▒ро┐роп рокрпЛродро┐ро▓рпБроорпН родро╛ройрпН рооро╛ро▒ро╛родрпБ роЗро░рпБроХрпНроХрпБроорпН <span class="text-yellow-700 font-bold">роЕро┤ро┐ро╡ро▒рпНро▒ роЖройрпНрооро╛ро╡рпЗ роиро╛ройрпН</span>."
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- 2. Breathing Exercise 1 -->
                <div class="bg-white rounded-xl shadow p-6 border-t-4 border-orange-400">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <span class="bg-orange-100 text-orange-600 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                        роЖро░роорпНрок роЪрпБро╡ро╛роЪрокрпН рокропро┐ро▒рпНроЪро┐ 1
                    </h3>
                    <p class="text-sm text-gray-500 mb-3">роЙроЯро▓рпИ роЗро▒рпБроХрпНроХро┐родрпН родро│ро░рпНродрпНродрпБроорпН роорпБро▒рпИ (3 роорпБро▒рпИ).</p>
                    <ul class="list-none space-y-3 text-sm text-gray-700">
                        <li><span class="text-orange-500 font-bold">A:</span> "ро╣, ро╣ро╛" роОрой ро╡ро╛ропрпН ро╡ро┤ро┐ропро╛роХ ро╡рпЖро│ро┐ропрпЗро▒рпНро▒ро╡рпБроорпН.</li>
                        <li><span class="text-orange-500 font-bold">B:</span> роиро╛роЪро┐ ро╡ро┤ро┐ропро╛роХ роЗро┤рпБродрпНродрпБ, роЙроЯро▓рпИ роЗро▒рпБроХрпНроХро╡рпБроорпН.</li>
                        <li><span class="text-orange-500 font-bold">C:</span> "ро╣, ро╣ро╛" роОрой ро╡рпЖро│ро┐ропрпЗро▒рпНро▒ро┐родрпН родро│ро░рпНродрпНродро╡рпБроорпН.</li>
                    </ul>
                </div>

                <!-- 3. Prayer & Chanting -->
                <div class="bg-white rounded-xl shadow p-6 border-t-4 border-pink-400">
                    <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                        рокро┐ро░ро╛ро░рпНродрпНродройрпИ & роХрпАродрооро┐роЪрпИродрпНродро▓рпН
                    </h3>
                    <div class="bg-pink-50 p-4 rounded-lg border border-pink-100 italic text-sm text-gray-700 space-y-2">
                        <p>"роирпА ро╡ро░рпБро╡ро╛ропрпН, родрпЖропрпНро╡родрпН родроирпНродрпИропрпЗ, роЙройродрпБ роЗро░рпБрокрпНрокро┐ройрпН рокро░роирпНрод роЗро░ро╛роЬрпНроЬро┐ропродрпНродрпИроХрпН роХро╛роЯрпНроЯрпБро╡ро╛ропро╛роХ!"</p>
                        <p>"роОройродрпБ роЗродропродрпНродро┐ро▒рпНроХрпБ ро╡ро┤ро┐рокроЯроХрпН роХро▒рпНро▒рпБроХрпН роХрпКроЯрпБрокрпНрокро╛ропрпН..."</p>
                    </div>
                </div>

                <!-- 4. Breathing Exercise 2 (20:20:20) -->
                <div class="bg-white rounded-xl shadow p-6 border-t-4 border-blue-400 md:col-span-2">
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                                <span class="bg-blue-100 text-blue-600 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                                роЪрпАро░рпН роЪрпБро╡ро╛роЪрокрпН рокропро┐ро▒рпНроЪро┐ (20:20:20 + 5)
                            </h3>
                            <p class="text-sm text-gray-600 mb-4">6 роорпБродро▓рпН 12 роорпБро▒рпИ роЪрпЖропрпНропро╡рпБроорпН.</p>
                            <div class="grid grid-cols-4 gap-2 text-center">
                                <div class="bg-blue-50 p-2 rounded border border-blue-200 text-xs"><b class="block text-blue-700 text-lg">20</b>роЙро│рпНроорпВроЪрпНроЪрпБ</div>
                                <div class="bg-yellow-50 p-2 rounded border border-yellow-200 text-xs"><b class="block text-yellow-700 text-lg">20</b>роиро┐ро▒рпБродрпНродроорпН</div>
                                <div class="bg-green-50 p-2 rounded border border-green-200 text-xs"><b class="block text-green-700 text-lg">20</b>ро╡рпЖро│ро┐роорпВроЪрпНроЪрпБ</div>
                                <div class="bg-purple-50 p-2 rounded border border-purple-200 text-xs"><b class="block text-purple-700 text-lg">05</b>роУропрпНро╡рпБ</div>
                            </div>
                        </div>

                        <!-- Breathing Timer -->
                        <div id="breath-timer-card" class="flex flex-col items-center justify-center bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <div class="relative rounded-full clock-face shadow-lg border-4 border-slate-100 flex items-center justify-center breath-face">
                                <div class="absolute inset-1 rounded-full tick-ring pointer-events-none"></div>
                                <div id="breath-indicator" class="second-indicator"></div>
                                <div class="absolute bg-white rounded-full z-10 flex flex-col items-center justify-center shadow-inner breath-core">
                                    <span id="breath-timer-display" class="text-2xl font-bold font-mono text-gray-700">00</span>
                                    <span class="text-xs text-gray-400 uppercase">Sec</span>
                                    <span id="breath-phase-label" class="text-[10px] font-bold text-blue-500 mt-1">START</span>
                                </div>
                                <div id="breath-clock-hand" class="hand absolute bottom-1/2 left-1/2 w-0.5 h-20 bg-gradient-to-t from-red-700 to-red-400 rounded-full z-20 origin-bottom -ml-[1px]"></div>
                                <div class="absolute w-4 h-4 bg-red-700 rounded-full z-30 border-2 border-white"></div>
                            </div>
                            <div class="mt-4 flex items-center gap-4">
                                <button onclick="toggleBreathMute()" id="breath-mute-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full p-3 shadow transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                                </button>
                                <button onclick="toggleBreathTimer()" id="breath-play-btn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-3 shadow transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </button>
                                <button onclick="toggleBreathTheme()" id="breath-theme-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full p-3 shadow transition" title="Light / Night theme">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m6.364.636l-1.414 1.414M21 12h-2m-1.636 6.364l-1.414-1.414M12 21v-2m-6.364-.636l1.414-1.414M3 12h2m1.636-6.364l1.414 1.414M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>
                                </button>
                                <button onclick="toggleWakeLock()" id="breath-wakelock-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full p-3 shadow transition" title="Keep screen on">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12c0 4.418-4.03 8-9 8-1.594 0-3.087-.366-4.36-1H5l-2 2v-3.337C2.343 16.115 2 14.602 2 13c0-4.418 4.03-8 9-8 1.594 0 3.087.366 4.36 1H19l2-2v3.337c.657 1.548 1 3.061 1 4.663z" /></svg>
                                </button>
                                <button onclick="toggleBreathFullscreen()" id="breath-fullscreen-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full p-3 shadow transition" title="Full screen">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V5a1 1 0 011-1h3M4 16v3a1 1 0 001 1h3m8-15h3a1 1 0 011 1v3m-4 8h3a1 1 0 001-1v-3" /></svg>
                                </button>
                                <div class="text-center ml-2">
                                    <p class="text-xs text-gray-500">роЪрпБро▒рпНро▒рпБроХро│рпН</p>
                                    <p id="breath-round-counter" class="text-xl font-bold text-blue-800">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. Meditation Phase WITH FIXED TIMER -->
                <div class="bg-indigo-50 rounded-xl shadow p-6 border-t-4 border-indigo-600 md:col-span-2">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Left: Settings -->
                        <div class="flex-1 space-y-4">
                            <h3 class="text-lg font-bold text-indigo-900 mb-3 flex items-center">
                                <span class="bg-indigo-200 text-indigo-800 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">5</span>
                                родро┐ропро╛ройроорпН (Meditation Proper)
                            </h3>
                            <div class="text-gray-700 text-sm space-y-2">
                                <p><strong>роХро╡ройроорпН:</strong> рокрпБро░рпБро╡роородрпНродро┐ (роЖройрпНроорпАроХроХрпН роХрогрпН).</p>
                                <p><strong>роороирпНродро┐ро░роорпН:</strong> "роЙройрпНройрпИ ро╡рпЖро│ро┐рокрпНрокроЯрпБродрпНродрпБро╡ро╛ропро╛роХ!"</p>
                            </div>
                            
                            <!-- Settings Form -->
                            <div class="bg-white p-4 rounded-lg border border-indigo-200 shadow-sm mt-4">
                                <h4 class="font-bold text-indigo-800 text-sm mb-3 border-b border-indigo-100 pb-2">роЯрпИрооро░рпН роЕроорпИрокрпНрокрпБроХро│рпН (Settings)</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">роЖропродрпНродроорпН (Warm-up)</label>
                                        <select id="med-warmup" class="w-full text-sm border-gray-300 rounded-md shadow-sm bg-gray-50 p-2">
                                            <option value="10" selected>10 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="30">30 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="60">60 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="0">роЗро▓рпНро▓рпИ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">родро┐ропро╛ройроорпН (Duration)</label>
                                        <select id="med-duration" class="w-full text-sm border-gray-300 rounded-md shadow-sm bg-gray-50 p-2">
                                            <option value="1">1 роиро┐рооро┐роЯроорпН (Test)</option>
                                            <option value="5">5 роиро┐рооро┐роЯроорпН</option>
                                            <option value="10">10 роиро┐рооро┐роЯроорпН</option>
                                            <option value="15">15 роиро┐рооро┐роЯроорпН</option>
                                            <option value="20" selected>20 роиро┐рооро┐роЯроорпН</option>
                                            <option value="30">30 роиро┐рооро┐роЯроорпН</option>
                                            <option value="45">45 роиро┐рооро┐роЯроорпН</option>
                                            <option value="60">60 роиро┐рооро┐роЯроорпН</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">роиро┐ро▒рпИро╡рпБ роЕроорпИродро┐</label>
                                        <select id="med-silence" class="w-full text-sm border-gray-300 rounded-md shadow-sm bg-gray-50 p-2">
                                            <option value="10" selected>10 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="30">30 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="60">60 ро╡ро┐роиро╛роЯро┐</option>
                                            <option value="0">роЗро▓рпНро▓рпИ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Advanced Timer UI -->
                        <div id="med-card" class="flex flex-col items-center justify-center text-white p-6 rounded-xl shadow-lg min-w-[300px] border relative overflow-hidden">
                            <div id="med-pulse" class="absolute inset-0 bg-indigo-500 opacity-0 rounded-xl transition-opacity duration-1000 mix-blend-screen"></div>
                            
                            <div class="z-10 text-center w-full">
                                <div id="med-phase-display" class="text-indigo-300 text-sm font-bold uppercase tracking-widest mb-2">родропро╛ро░рпН (Ready)</div>
                                <div id="med-timer-display" class="text-5xl font-mono font-bold mb-4 tabular-nums">20:00</div>
                                
                                <div class="w-full bg-indigo-800 rounded-full h-2 mb-6 overflow-hidden">
                                    <div id="med-progress" class="bg-indigo-400 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>

                                <div class="flex justify-center gap-4">
                                    <button onclick="toggleMeditation()" id="med-play-btn" class="bg-white text-indigo-900 hover:bg-indigo-100 rounded-full p-4 shadow-lg transition transform hover:scale-105">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                    </button>
                                    <button onclick="resetMeditation()" class="bg-indigo-700 text-indigo-200 hover:bg-indigo-600 rounded-full p-4 shadow-lg transition" title="Reset">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                                    </button>
                                    <button onclick="toggleMeditationTheme()" id="med-theme-btn" class="bg-gray-100 text-indigo-900 hover:bg-gray-200 rounded-full p-4 shadow-lg transition" title="Light / Night theme">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m6.364.636l-1.414 1.414M21 12h-2m-1.636 6.364l-1.414-1.414M12 21v-2m-6.364-.636l1.414-1.414M3 12h2m1.636-6.364l1.414 1.414M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>
                                    </button>
                                    <button onclick="toggleWakeLock()" id="med-wakelock-btn" class="bg-gray-100 text-indigo-900 hover:bg-gray-200 rounded-full p-4 shadow-lg transition" title="Keep screen on">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12c0 4.418-4.03 8-9 8-1.594 0-3.087-.366-4.36-1H5l-2 2v-3.337C2.343 16.115 2 14.602 2 13c0-4.418 4.03-8 9-8 1.594 0 3.087.366 4.36 1H19l2-2v3.337c.657 1.548 1 3.061 1 4.663z" /></svg>
                                    </button>
                                    <button onclick="toggleMeditationFullscreen()" id="med-fullscreen-btn" class="bg-gray-100 text-indigo-900 hover:bg-gray-200 rounded-full p-4 shadow-lg transition" title="Full screen">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V5a1 1 0 011-1h3M4 16v3a1 1 0 001 1h3m8-15h3a1 1 0 011 1v3m-4 8h3a1 1 0 001-1v-3" /></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. Closing -->
                <div class="bg-white rounded-xl shadow p-6 border-t-4 border-gray-400 md:col-span-2 text-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">роиро┐ро▒рпИро╡рпБ</h3>
                    <p class="text-sm text-gray-700">роЗро▒рпИро╡ройрпБроХрпНроХро╛рой роУро░рпН роЗродропроЩрпНроХройро┐роирпНрод роиройрпНро▒ро┐ропрпБроЯройрпН родро┐ропро╛ройродрпНродрпИ роиро┐ро▒рпИро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.</p>
                    <div class="mt-4 flex justify-center">
                        <img src="../asset/image copy.png" alt="Closing gratitude" class="max-w-xs rounded-lg shadow-md border border-gray-200">
                    </div>
                </div>

            </div>
        </section>

        <!-- Light Flame Meditation (Final) -->
        <section id="flame-meditation" class="relative overflow-hidden rounded-2xl shadow-lg p-8 border border-orange-300 bg-gradient-to-b from-slate-950 via-slate-900 to-black text-orange-50">
            <div class="flex flex-col lg:flex-row items-center gap-10 flame-layout">
                <div class="flex-1 text-center">
                    <div class="flame-wrap">
                        <img src="../asset/candle-1823.gif" alt="Candle flame" id="live-flame" class="flame-photo">
                    </div>
                </div>
                <div class="flex-1 w-full space-y-4 flame-panel">
                    <div class="flex items-center gap-3 flex-wrap flame-select-row">
                        <select id="flame-duration-select" class="flame-select">
                            <option value="">--</option>
                            <option value="3">3 роиро┐рооро┐роЯроорпН</option>
                            <option value="5">5 роиро┐рооро┐роЯроорпН</option>
                            <option value="7">7 роиро┐рооро┐роЯроорпН</option>
                            <option value="10">10 роиро┐рооро┐роЯроорпН</option>
                            <option value="15">15 роиро┐рооро┐роЯроорпН</option>
                            <option value="20">20 роиро┐рооро┐роЯроорпН</option>
                        </select>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-4 shadow border border-orange-500/40 space-y-3 flame-timer-box">
                        <div class="flex items-center justify-between gap-4 flex-wrap">
                            <div>
                                <div id="flame-timer-display" class="text-4xl font-mono font-bold text-amber-200 tabular-nums">00:00</div>
                            </div>
                            <div class="flex items-center gap-2 flame-controls">
                                <button id="flame-fullscreen-btn" class="px-3 py-2 rounded-lg bg-orange-500 text-white hover:bg-orange-400 shadow-md transition" title="Maximize">тдв</button>
                                <button id="flame-reset-btn" class="px-4 py-2 rounded-lg bg-orange-600 text-white hover:bg-orange-500 shadow-md transition">Reset</button>
                            </div>
                        </div>
                        <div class="flame-progress">
                            <div id="flame-progress-bar" class="flame-progress-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ego vs Soul Card -->
        <section class="mt-8">
            <div class="relative overflow-hidden rounded-2xl shadow-xl border border-purple-200 bg-gradient-to-br from-purple-50 via-white to-amber-50">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-purple-200/40 rounded-full blur-3xl"></div>
                <div class="absolute -left-16 bottom-0 w-52 h-52 bg-amber-200/30 rounded-full blur-3xl"></div>
                <div class="relative p-8 md:p-10 space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-orange-400 text-white flex items-center justify-center text-2xl shadow-lg">ЁЯОн</div>
                            <h3 class="text-2xl font-bold text-gray-900">роЖройрпНрооро╛ро╡ро┐ро▒рпНроХрпБ роОродро┐ро░ро╛роХ роЕроХроирпНродрпИ</h3>
                        </div>
                        <span class="text-sm font-semibold text-purple-700 bg-purple-100 px-3 py-1 rounded-full">рокроХро╡родрпН роХрпАродрпИ (рокроХро╡ро╛ройрпН роХро┐ро░рпБро╖рпНрогройрпН)</span>
                    </div>
                    <p class="text-gray-800 leading-relaxed">
                        роЖройрпНрооро╛, рокрпВрод роЙроЯро▓рпБроЯройрпБроорпН роЕродройрпН роХрпБро▒рпИрокро╛роЯрпБро│рпНро│ рокрпБро▓ройрпБрогро░рпНро╡рпБроХрпН роХро░рпБро╡ро┐роХро│рпБроЯройрпБроорпН роЕроЯрпИропро╛ро│рокрпНрокроЯрпБродрпНродро┐роХрпН роХрпКрогрпНроЯрпБ рооройро┐род роЕроХроирпНродрпИ роЖроХро┐ро▒родрпБ. рооро╛ропрпИропро┐ройрпН роорпВро▓роорпН рооро╛ро▒ро╛род роЕрооро░родрпНродрпБро╡ роЖройрпНрооро╛, рооро╛ро▒рпНро▒родрпНродрпБроЯройрпБроорпН роЕро┤ро┐ро╡рпБроЯройрпБроорпН родройрпНройрпИропрпЗ роЕроЯрпИропро╛ро│рокрпНрокроЯрпБродрпНродро┐роХрпН роХрпКро│рпНроХро┐ро▒родрпБ.
                    </p>
                    <div class="bg-white/70 border border-purple-100 rounded-xl p-5 shadow-sm">
                        <p class="text-gray-900 leading-relaxed">
                            роЕройрпИродрпНродрпБ роЙрогрпНроорпИропро╛рой роЖройрпНроорпАроХ рокрпЛродройрпИроХро│ро┐ройрпН роирпЛроХрпНроХроорпН, роЕроХроирпНродрпИ рооро▒рпНро▒рпБроорпН роЕродройрпН родро╡ро▒ро╛рой рооройрокрпНрокро╛ройрпНроорпИроХро│рпИроХрпН роХроЯроирпНродрпБ, роЖройрпНроо роЙрогро░рпНро╡рпБроиро┐ро▓рпИропро┐ройрпН роЗро┤роирпНрод роЪрпКро░рпНроХрпНроХродрпНродрпИ роорпАрогрпНроЯрпБроорпН рокрпЖро▒рпБро╡родрпЗ роЖроХрпБроорпН. роиро╛роорпН рокро░роорпНрокрпКро░рпБро│рпБроЯройрпН роТройрпНро▒ро╛роХро┐ роЗро░рпБроХрпНроХро┐ро▒рпЛроорпН роОройрпНрокродрпИ роЕро▒ро┐ро╡родро▒рпНроХро╛рой родро▓рпИроЪро┐ро▒роирпНрод ро╡ро┤ро┐ родро┐ропро╛ройрооро╛роХрпБроорпН.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Infographic: Self-Mastery Path -->
        <section class="mt-10">
            <div class="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 text-white rounded-2xl shadow-xl border border-slate-700 p-8">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-full bg-indigo-500 flex items-center justify-center text-2xl">ЁЯзн</div>
                    <h3 class="text-2xl font-bold">роЪрпБроп-ро╡ро▓рпНро▓роорпИ роЕроЯрпИропрпБроорпН ро╡ро┤ро┐роорпБро▒рпИ</h3>
                </div>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white/5 border border-white/10 rounded-xl p-5 shadow-md">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ЁЯза</span>
                            <p class="text-lg font-semibold">рооройроХрпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпБ</p>
                        </div>
                        <p class="text-sm text-slate-100 leading-relaxed">роЙроЯро▓рпИ роТро░рпБроорпБроХрокрпНрокроЯрпНроЯ рооройроорпН, роЗроЪрпНроЪро╛ роЪроХрпНродро┐ рооро▒рпНро▒рпБроорпН рокроХрпБродрпНродро▒ро┐ропрпБроорпН ро╡ро┐ро╡рпЗроХроорпН роЖроХро┐ропро╡ро▒рпНро▒ро┐ройрпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯро┐ройрпН роХрпАро┤рпН роХрпКрогрпНроЯрпБ ро╡ро░рпБродро▓рпН.</p>
                    </div>
                    <div class="bg-white/5 border border-white/10 rounded-xl p-5 shadow-md">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ЁЯСС</span>
                            <p class="text-lg font-semibold">роЙрогрпНроорпИропро╛рой рокрпЗро░ро░роЪро░рпН</p>
                        </div>
                        <p class="text-sm text-slate-100 leading-relaxed">родро╡ро▒ро╛роХ ро╡ро┤ро┐роХро╛роЯрпНроЯрокрпНрокроЯрпНроЯ рооройродрпН родро┐ро▒ройрпНроХро│рпИ, родрпЖропрпНро╡рпАроХ роЮро╛ройроорпН рооро▒рпНро▒рпБроорпН роЕройрпНрокрпБ роХрпКрогрпНроЯ роЖройрпНрооро╛ро╡ро┐ройрпН (рокрпЗро░ро░роЪро░ро┐ройрпН) роЖроЯрпНроЪро┐ропро┐ройрпН роХрпАро┤рпН роХрпКрогрпНроЯрпБ ро╡ро░рпБродро▓рпН.</p>
                    </div>
                    <div class="bg-white/5 border border-white/10 rounded-xl p-5 shadow-md">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ЁЯММ</span>
                            <p class="text-lg font-semibold">родрпЖропрпНро╡рпАроХ роРроХрпНроХро┐ропроорпН</p>
                        </div>
                        <p class="text-sm text-slate-100 leading-relaxed">родройро┐рокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ роЖройрпНрооро╛ро╡рпИ, роЕройрпИродрпНродрпБрокрпН рокроЯрпИрокрпНрокрпБроХро│ро┐ро▓рпБроорпН роКроЯрпБро░рпБро╡ро┐ропро┐ро░рпБроХрпНроХрпБроорпН роОро▓рпНро▓рпИропро▒рпНро▒ роЪро░рпНро╡ро╡ро┐ропро╛рокроХрокрпН рокро░роорпНрокрпКро░рпБро│рпБроЯройрпН роРроХрпНроХро┐ропрооро╛роХрпНроХрпБродро▓рпН.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Infographic: Three Bodies -->
        <section class="mt-10">
            <div class="bg-[#0f172a] text-white rounded-2xl shadow-2xl border border-slate-800 p-8 md:p-10">
                <div class="text-center mb-8 space-y-2">
                    <h3 class="text-3xl md:text-4xl font-bold text-amber-300">рооройро┐родройро┐ройрпН роорпВройрпНро▒рпБ роЙроЯро▓рпНроХро│рпН</h3>
                    <p class="text-slate-200">роЖройрпНрооро╛ роОройрпБроорпН роТро│ро┐роХрпНроХродро┐ро░рпН роорпВройрпНро▒рпБ роЙро▒рпИроХро│ро╛ро▓рпН роорпВроЯрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ</p>
                </div>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="relative rounded-2xl bg-slate-900 border border-amber-200/30 shadow-[0_25px_60px_rgba(251,191,36,0.2)] p-6 flex flex-col items-center text-center">
                        <div class="w-14 h-14 rounded-full bg-amber-400 flex items-center justify-center text-2xl mb-3">тЬи</div>
                        <p class="text-xl font-bold text-amber-200 mb-1">1. роХро╛ро░рог роЙроЯро▓рпН</p>
                        <p class="text-sm text-amber-100 mb-2">(Causal Body)</p>
                        <p class="text-sm text-slate-100 leading-relaxed">рокрпЗро░ро┐ройрпНрокродрпНродро╛ро▓рпБроорпН родрпВроп роЙро│рпНро│рпБрогро░рпНро╡рпБ-роЙрогро░рпНро╡рпБроиро┐ро▓рпИропро╛ро▓рпБроорпН роЖройродрпБ. роЗродрпБро╡рпЗ роЖройрпНрооро╛ро╡ро┐ройрпН роорпБродро▓рпН роЙро▒рпИ.</p>
                    </div>
                    <div class="relative rounded-2xl bg-slate-900 border border-blue-200/30 shadow-[0_25px_60px_rgba(59,130,246,0.18)] p-6 flex flex-col items-center text-center">
                        <div class="w-14 h-14 rounded-full bg-blue-500 flex items-center justify-center text-2xl mb-3">тЪб</div>
                        <p class="text-xl font-bold text-blue-100 mb-1">2. роЪрпВроЯрпНроЪрпБроо роЙроЯро▓рпН</p>
                        <p class="text-sm text-blue-100/80 mb-2">(Astral Body)</p>
                        <p class="text-sm text-slate-100 leading-relaxed">рооройроорпН, роЕро▒ро┐ро╡рпБ рооро▒рпНро▒рпБроорпН рокро┐ро░ро╛рогройрпН (роЙропро┐ро░рпНроЪрпНроЪроХрпНродро┐) роЖроХро┐ропро╡ро▒рпНро▒ро╛ро▓рпН роЖройродрпБ. роЕро┤ро┐ропро╛род роТро│ро┐ ро╡роЯро┐ро╡роорпН.</p>
                    </div>
                    <div class="relative rounded-2xl bg-slate-900 border border-rose-200/30 shadow-[0_25px_60px_rgba(244,63,94,0.18)] p-6 flex flex-col items-center text-center">
                        <div class="w-14 h-14 rounded-full bg-rose-500 flex items-center justify-center text-2xl mb-3">ЁЯзШ</div>
                        <p class="text-xl font-bold text-rose-100 mb-1">3. рокрпВрод роЙроЯро▓рпН</p>
                        <p class="text-sm text-rose-100/80 mb-2">(Physical Body)</p>
                        <p class="text-sm text-slate-100 leading-relaxed">роЕро┤ро┐ропрпБроорпН рокрпКро░рпБроЯрпНроХро│ро╛ро▓рпН роЖройродрпБ. родроЪрпИ рооро▒рпНро▒рпБроорпН роОро▓рпБроорпНрокрпБроХро│рпИроХрпН роХрпКрогрпНроЯ родро▒рпНрокрпЛродрпИроп ро╡роЯро┐ро╡роорпН.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Closing Note -->
        <section class="mt-10 bg-white rounded-2xl shadow p-6 border border-gray-200">
            <p class="text-lg text-gray-800 leading-relaxed">
                <strong>роХродрпИ:</strong> роУро░рпН роЕро░роЪройрпИ родройрпН роЖройрпНроорпАроХ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропро╛роХродрпН родрпЗро░рпНроирпНродрпЖроЯрпБродрпНрод роТро░рпБ роороХро╛ройрпН роЗро▒рпИро╡ройро┐ройрпН роЗро░рпБрокрпНрокрпИ роЕроХроорпБроХрооро╛роХ роЙрогро░рпНроирпНрод ро╡рогрпНрогроорпН, роОро▓рпНро▓ро╛ роорпБро▒рпИропро╛рой ро╡рпЖро│ро┐рокрпНрокрпБро▒роХрпН роХроЯроорпИроХро│рпИропрпБроорпН роиро┐ро▒рпИро╡рпЗро▒рпНро▒рпБро╡родрпЗ ро╡ро╛ро┤рпНро╡родро▒рпНроХро╛рой роЪро┐ро▒роирпНрод ро╡ро┤ро┐ропро╛роХрпБроорпН тАФ роирпАроЯро┐родрпНрод роороХро┐ро┤рпНроЪрпНроЪро┐роХрпНроХро╛рой ро╡ро┤ро┐.
            </p>
            <p class="mt-4 text-sm text-gray-700">
                роЗройрпНро▒рпБ роЙроЩрпНроХро│рпН роорпБроХрпНроХро┐ропрокрпН рокрогро┐роХро│рпИ роОро┤рпБродро┐роХрпН роХрпБро▒ро┐рокрпНрокро┐роЯрпБроЩрпНроХро│рпН; роЕро╡ро▒рпНро▒рпИ роиро┐ро▒рпИро╡рпЗро▒рпНро▒ро┐ тАЬро╡рпЖро│ро┐рокрпНрокрпБро▒роХрпН роХроЯроорпИроХро│рпИропрпБроорпН роиро┐ро▒рпИро╡рпЗро▒рпНро▒рпБро╡родрпЗтАЭ роОройрпНро▒ рокро╛роЯродрпНродрпИроЪрпН роЪрпЖропрпНродрпБ роХро╛рогрпНрокрпЛроорпН.
            </p>
        </section>

    </main>

    <script>
        // GLOBAL AUDIO CONTEXT
        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        /* ---------------- LIGHT FLAME TIMER ---------------- */
        const flameSelect = document.getElementById('flame-duration-select');
        const flameDisplay = document.getElementById('flame-timer-display');
        const flameProgressBar = document.getElementById('flame-progress-bar');
        const flameResetBtn = document.getElementById('flame-reset-btn');
        const flameFullscreenBtn = document.getElementById('flame-fullscreen-btn');
        const flameSection = document.getElementById('flame-meditation');
        const flameCore = document.getElementById('live-flame');
        let flameInterval;
        let flameTotalSeconds = 0;
        let flameRemainingSeconds = 0;

        function formatFlame(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateFlameUI() {
            flameDisplay.innerText = formatFlame(flameRemainingSeconds);
            if (flameTotalSeconds > 0) {
                const pct = ((flameTotalSeconds - flameRemainingSeconds) / flameTotalSeconds) * 100;
                flameProgressBar.style.width = `${pct}%`;
            } else {
                flameProgressBar.style.width = '0%';
            }
        }

        function startFlameTimer(minutes) {
            clearInterval(flameInterval);
            flameTotalSeconds = minutes * 60;
            flameRemainingSeconds = flameTotalSeconds;
            flameSelect.value = minutes.toString();
            flameCore.style.animationPlayState = 'running';
            updateFlameUI();

            flameInterval = setInterval(() => {
                flameRemainingSeconds -= 1;
                if (flameRemainingSeconds <= 0) {
                    clearInterval(flameInterval);
                    flameRemainingSeconds = 0;
                    flameCore.style.animationPlayState = 'paused';
                    updateFlameUI();
                    return;
                }
                updateFlameUI();
            }, 1000);
        }

        function resetFlameTimer() {
            clearInterval(flameInterval);
            flameTotalSeconds = 0;
            flameRemainingSeconds = 0;
            if (flameSelect) flameSelect.value = "";
            flameCore.style.animationPlayState = 'running';
            updateFlameUI();
        }

        if (flameSelect) {
            flameSelect.addEventListener('change', (e) => {
                const minutes = Number(e.target.value);
                if (minutes) startFlameTimer(minutes);
            });
        }
        flameResetBtn.addEventListener('click', resetFlameTimer);

        // Fullscreen toggle for flame
        function updateFlameFullscreenIcon() {
            const isFs = document.fullscreenElement === flameSection || document.webkitFullscreenElement === flameSection;
            flameFullscreenBtn.textContent = 'тдв';
            if (isFs) {
                flameSection.classList.add('flame-only');
            } else {
                flameSection.classList.remove('flame-only');
            }
        }

        function toggleFlameFullscreen() {
            const el = flameSection;
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (el.requestFullscreen) el.requestFullscreen();
                else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }
        flameFullscreenBtn.addEventListener('click', toggleFlameFullscreen);
        document.addEventListener('fullscreenchange', updateFlameFullscreenIcon);
        document.addEventListener('webkitfullscreenchange', updateFlameFullscreenIcon);

        resetFlameTimer();

        /* ---------------- BREATHING TIMER LOGIC ---------------- */
        let breathIsPlaying = false;
        let breathIsMuted = false;
        let breathInterval;
        let breathElapsedSeconds = 0;
        let breathRounds = 0;
        const breathTotalDuration = 65;

        const breathPlayBtn = document.getElementById('breath-play-btn');
        const breathMuteBtn = document.getElementById('breath-mute-btn');
        const breathHand = document.getElementById('breath-clock-hand');
        const breathIndicator = document.getElementById('breath-indicator');
        const breathTimerCard = document.getElementById('breath-timer-card');
        const breathFullscreenBtn = document.getElementById('breath-fullscreen-btn');
        const breathThemeBtn = document.getElementById('breath-theme-btn');
        const breathWakeLockBtn = document.getElementById('breath-wakelock-btn');
        const breathDisplay = document.getElementById('breath-timer-display');
        const breathRoundCounter = document.getElementById('breath-round-counter');
        const breathPhaseLabel = document.getElementById('breath-phase-label');

        function playSoftTick() {
            if (breathIsMuted || !audioCtx) return;
            const now = audioCtx.currentTime;
            const master = audioCtx.createGain();
            master.gain.setValueAtTime(0.25, now);
            master.connect(audioCtx.destination);

            // Heartbeat: soft double-thump (lub-dub)
            function thump(startOffset, baseFreq) {
                const osc = audioCtx.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(baseFreq, now + startOffset);
                osc.frequency.exponentialRampToValueAtTime(baseFreq * 0.8, now + startOffset + 0.08);

                const gain = audioCtx.createGain();
                gain.gain.setValueAtTime(0, now + startOffset);
                gain.gain.linearRampToValueAtTime(0.05, now + startOffset + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.0001, now + startOffset + 0.35);

                osc.connect(gain);
                gain.connect(master);
                osc.start(now + startOffset);
                osc.stop(now + startOffset + 0.4);
            }

            thump(0, 90);     // lub
            thump(0.18, 110); // dub
        }

        function toggleBreathMute() {
            breathIsMuted = !breathIsMuted;
            breathMuteBtn.innerHTML = breathIsMuted ? 
                '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" /></svg>' : 
                '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>';
        }

        function toggleBreathTheme() {
            breathTimerCard.classList.toggle('breath-night');
            const isNight = breathTimerCard.classList.contains('breath-night');
            breathThemeBtn.innerHTML = isNight
                ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" /></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m6.364.636l-1.414 1.414M21 12h-2m-1.636 6.364l-1.414-1.414M12 21v-2m-6.364-.636l1.414-1.414M3 12h2m1.636-6.364l1.414 1.414M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>';
        }

        /* Wake Lock (keep screen on) shared for both timers */
        let wakeLock = null;
        let wakeLockEnabled = false;

        function updateWakeLockIcons() {
            const iconOn = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" /></svg>';
            const iconOff = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/><line x1="8" y1="8" x2="16" y2="16" stroke-width="2"/><line x1="16" y1="8" x2="8" y2="16" stroke-width="2"/></svg>';
            [breathWakeLockBtn, typeof medWakeLockBtn !== 'undefined' ? medWakeLockBtn : null].forEach(btn => {
                if (!btn) return;
                btn.innerHTML = wakeLockEnabled ? iconOn : iconOff;
                if (wakeLockEnabled) btn.classList.add('wake-active');
                else btn.classList.remove('wake-active');
            });
        }

        async function requestWakeLock() {
            if (!('wakeLock' in navigator)) {
                alert('Screen wake lock is not supported on this device/browser.');
                return;
            }
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                wakeLockEnabled = true;
                updateWakeLockIcons();
                wakeLock.addEventListener('release', () => {
                    wakeLockEnabled = false;
                    updateWakeLockIcons();
                });
            } catch (err) {
                console.warn('Wake lock request failed', err);
                alert('Unable to keep the screen awake: ' + (err.message || err));
            }
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
            wakeLockEnabled = false;
            updateWakeLockIcons();
        }

        function toggleWakeLock() {
            if (wakeLockEnabled) {
                releaseWakeLock();
            } else {
                requestWakeLock();
            }
        }

        function updateBreathPhase(seconds) {
            let cycle = seconds % 65;
            if (cycle === 0 && seconds > 0) cycle = 65;
            
            if (cycle <= 20) { breathPhaseLabel.innerText = "роЙро│рпНроорпВроЪрпНроЪрпБ"; breathPhaseLabel.className = "text-[10px] font-bold text-blue-600 mt-1 uppercase"; }
            else if (cycle <= 40) { breathPhaseLabel.innerText = "роиро┐ро▒рпБродрпНродроорпН"; breathPhaseLabel.className = "text-[10px] font-bold text-yellow-600 mt-1 uppercase"; }
            else if (cycle <= 60) { breathPhaseLabel.innerText = "ро╡рпЖро│ро┐роорпВроЪрпНроЪрпБ"; breathPhaseLabel.className = "text-[10px] font-bold text-green-600 mt-1 uppercase"; }
            else { breathPhaseLabel.innerText = "роУропрпНро╡рпБ"; breathPhaseLabel.className = "text-[10px] font-bold text-purple-600 mt-1 uppercase"; }
        }

        function toggleBreathTimer() {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            breathIsPlaying = !breathIsPlaying;
            if (breathIsPlaying) {
                breathPlayBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                updateBreathPhase(breathElapsedSeconds);
                
                breathInterval = setInterval(() => {
                    breathElapsedSeconds++;
                    if (breathElapsedSeconds % 2 === 0) playSoftTick(); // sound every 2 seconds
                    updateBreathPhase(breathElapsedSeconds);
                    const rotation = breathElapsedSeconds * (360 / 65);
                    breathHand.style.transform = `rotate(${rotation}deg)`;
                    breathIndicator.style.transform = `rotate(${rotation}deg)`;
                    let displayTime = breathElapsedSeconds % 65;
                    if (displayTime === 0) displayTime = 65;
                    breathDisplay.innerText = displayTime.toString().padStart(2, '0');
                    if (breathElapsedSeconds > 0 && breathElapsedSeconds % 65 === 0) {
                        breathRounds++;
                        breathRoundCounter.innerText = breathRounds;
                    }
                }, 1000);
            } else {
                clearInterval(breathInterval);
                breathPlayBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            }
        }

        // Fullscreen toggle for breathing timer
        function updateBreathFullscreenIcon() {
            const isFs = document.fullscreenElement === breathTimerCard || document.webkitFullscreenElement === breathTimerCard;
            breathFullscreenBtn.innerHTML = isFs
                ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9H5a1 1 0 01-1-1V4m0 16v-4a1 1 0 011-1h4m6 6v-4a1 1 0 011-1h4m0-6h-4a1 1 0 01-1-1V4" /></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V5a1 1 0 011-1h3M4 16v3a1 1 0 001 1h3m8-15h3a1 1 0 011 1v3m-4 8h3a1 1 0 001-1v-3" /></svg>';
        }

        function toggleBreathFullscreen() {
            const el = breathTimerCard;
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (el.requestFullscreen) el.requestFullscreen();
                else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

        document.addEventListener('fullscreenchange', updateBreathFullscreenIcon);
        document.addEventListener('webkitfullscreenchange', updateBreathFullscreenIcon);

        /* ---------------- MEDITATION TIMER LOGIC ---------------- */
        let medInterval;
        let medState = 'IDLE'; 
        let medPreviousState = 'IDLE'; // Fixed: Missing variable added
        let medTimeRemaining = 0;
        let medTotalCurrentPhaseTime = 0;
        function setMedBackground(mode) {
            medCard.classList.remove('med-warm', 'med-active', 'med-silence');
            if (mode) medCard.classList.add(mode);
        }

        const medDisplay = document.getElementById('med-timer-display');
        const medPhaseDisplay = document.getElementById('med-phase-display');
        const medPlayBtn = document.getElementById('med-play-btn');
        const medProgress = document.getElementById('med-progress');
        const medPulse = document.getElementById('med-pulse');
        const medCard = document.getElementById('med-card');
        const medThemeBtn = document.getElementById('med-theme-btn');
        const medFullscreenBtn = document.getElementById('med-fullscreen-btn');
        const medWakeLockBtn = document.getElementById('med-wakelock-btn');

        const inputWarmup = document.getElementById('med-warmup');
        const inputDuration = document.getElementById('med-duration');
        const inputSilence = document.getElementById('med-silence');

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function playTempleBell() {
            initAudio();
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const now = audioCtx.currentTime;
            const frequencies = [1, 2, 3, 4.2]; 
            const decays = [3.5, 2.5, 1.5, 1.0]; 
            const baseFreq = 220; 

            frequencies.forEach((ratio, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(baseFreq * ratio, now);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.3 / (i + 1), now + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, now + decays[i]);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + decays[i] + 0.1);
            });
        }

        function updateMeditationDisplay() {
            medDisplay.innerText = formatTime(medTimeRemaining);
            if (medTotalCurrentPhaseTime > 0) {
                const percentage = ((medTotalCurrentPhaseTime - medTimeRemaining) / medTotalCurrentPhaseTime) * 100;
                medProgress.style.width = `${percentage}%`;
            } else {
                medProgress.style.width = '0%';
            }
        }

        function switchMeditationPhase(newState) {
            medState = newState;
            medPulse.style.opacity = '0.5';
            setTimeout(() => { medPulse.style.opacity = '0'; }, 500);

            if (medState === 'WARMUP') {
                const warmupSecs = parseInt(inputWarmup.value);
                if (warmupSecs > 0) {
                    medTimeRemaining = warmupSecs;
                    medTotalCurrentPhaseTime = warmupSecs;
                    medPhaseDisplay.innerText = "роЖропродрпНродроорпН (WARM-UP)";
                    medPhaseDisplay.className = "text-amber-800 text-sm font-bold uppercase tracking-widest mb-2";
                    setMedBackground('med-warm');
                    updateMeditationDisplay(); // Immediate Update
                } else {
                    switchMeditationPhase('MEDITATION');
                }
            } 
            else if (medState === 'MEDITATION') {
                playTempleBell();
                const durMins = parseInt(inputDuration.value);
                medTimeRemaining = durMins * 60;
                medTotalCurrentPhaseTime = medTimeRemaining;
                medPhaseDisplay.innerText = "родро┐ропро╛ройроорпН (MEDITATION)";
                medPhaseDisplay.className = "text-sky-900 text-sm font-bold uppercase tracking-widest mb-2";
                setMedBackground('med-active');
                updateMeditationDisplay(); // Immediate Update
            } 
            else if (medState === 'SILENCE') {
                playTempleBell();
                const silenceSecs = parseInt(inputSilence.value);
                if (silenceSecs > 0) {
                    medTimeRemaining = silenceSecs;
                    medTotalCurrentPhaseTime = silenceSecs;
                    medPhaseDisplay.innerText = "роиро┐ро▒рпИро╡рпБ роЕроорпИродро┐ (SILENCE)";
                    medPhaseDisplay.className = "text-emerald-800 text-sm font-bold uppercase tracking-widest mb-2";
                    setMedBackground('med-silence');
                    updateMeditationDisplay(); // Immediate Update
                } else {
                    switchMeditationPhase('END');
                }
            } 
            else if (medState === 'END') {
                playTempleBell();
                resetMeditation();
                medPhaseDisplay.innerText = "роиро┐ро▒рпИро╡рпБ (COMPLETED)";
                setMedBackground('');
            }
        }

        function toggleMeditation() {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            if (medState === 'IDLE' || medState === 'PAUSED') {
                if (medState === 'IDLE') {
                    switchMeditationPhase('WARMUP'); // Start fresh
                } else {
                    medState = medPreviousState; // Resume
                }

                medPlayBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';

                medInterval = setInterval(() => {
                    if (medTimeRemaining > 0) {
                    medTimeRemaining--;
                    updateMeditationDisplay();
                } else {
                    if (medState === 'WARMUP') switchMeditationPhase('MEDITATION');
                    else if (medState === 'MEDITATION') switchMeditationPhase('SILENCE');
                    else if (medState === 'SILENCE') switchMeditationPhase('END');
                }
            }, 1000);
            } else {
                clearInterval(medInterval);
                medPreviousState = medState;
                medState = 'PAUSED';
                medPlayBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            }
        }

        function resetMeditation() {
            clearInterval(medInterval);
            medState = 'IDLE';
            medTimeRemaining = parseInt(inputDuration.value) * 60;
            medTotalCurrentPhaseTime = 0;
            
            medPhaseDisplay.innerText = "родропро╛ро░рпН (READY)";
            medPhaseDisplay.className = "text-indigo-300 text-sm font-bold uppercase tracking-widest mb-2";
            medDisplay.innerText = formatTime(medTimeRemaining);
            medProgress.style.width = '0%';
            
            medPlayBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
        }

        // Initialize Display
        medDisplay.innerText = formatTime(parseInt(inputDuration.value) * 60);
        
        // Update display on settings change
        inputDuration.addEventListener('change', () => {
            if (medState === 'IDLE') {
                medDisplay.innerText = formatTime(parseInt(inputDuration.value) * 60);
            }
        });

        // Theme toggle for meditation card
        function toggleMeditationTheme() {
            medCard.classList.toggle('med-night');
            const isNight = medCard.classList.contains('med-night');
            medThemeBtn.innerHTML = isNight
                ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" /></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m6.364.636l-1.414 1.414M21 12h-2m-1.636 6.364l-1.414-1.414M12 21v-2m-6.364-.636l1.414-1.414M3 12h2m1.636-6.364l1.414 1.414M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>';
        }

        // Fullscreen toggle for meditation timer
        function updateMeditationFullscreenIcon() {
            const isFs = document.fullscreenElement === medCard || document.webkitFullscreenElement === medCard;
            medFullscreenBtn.innerHTML = isFs
                ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9H5a1 1 0 01-1-1V4m0 16v-4a1 1 0 011-1h4m6 6v-4a1 1 0 011-1h4m0-6h-4a1 1 0 01-1-1V4" /></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V5a1 1 0 011-1h3M4 16v3a1 1 0 001 1h3m8-15h3a1 1 0 011 1v3m-4 8h3a1 1 0 001-1v-3" /></svg>';
        }

        function toggleMeditationFullscreen() {
            const el = medCard;
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (el.requestFullscreen) el.requestFullscreen();
                else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

        document.addEventListener('fullscreenchange', updateMeditationFullscreenIcon);
        document.addEventListener('webkitfullscreenchange', updateMeditationFullscreenIcon);

        // Maintain wake lock state across tab visibility changes
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && wakeLockEnabled) {
                requestWakeLock();
            }
        });

        // Initial icon states
        updateWakeLockIcons();
    </script>
</body>
</html>
